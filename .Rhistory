}
#NC_coding_genes
temp <- res.deseq2[gene_type == 'protein_coding' & regulation == 'NC' & seqnames != 'chrM',] %>% makeGRangesFromDataFrame()
GROPlotonTemp(temp,'NC_TSS','NC_protein_coding_genes','figures/GRO-seq_on_NC_TSS.jpg')
ChIPPlotonTemp(temp,'H3K27ac','NC_genes','H3K27ac_NC_protein_coding_genes','figures/H3K27ac_on_NC_TSS.jpg')
ChIPPlotonTemp(temp,'H3K4me1','NC_genes','H3K4me1_NC_protein_coding_genes','figures/H3K4me1_on_NC_TSS.jpg')
ChIPPlotonTemp(temp,'Pol2','NC_genes','Pol2_NC_protein_coding_genes','figures/Pol2_on_NC_TSS.jpg')
ChIPPlotonTemp(temp,'H3K27ac','NC_TSS','H3K27ac_NC_protein_coding_genes','figures/H3K27ac_on_NC_TSS.jpg')
ChIPPlotonTemp(temp,'H3K4me1','NC_TSS','H3K4me1_NC_protein_coding_genes','figures/H3K4me1_on_NC_TSS.jpg')
ChIPPlotonTemp(temp,'Pol2','NC_TSS','Pol2_NC_protein_coding_genes','figures/Pol2_on_NC_TSS.jpg')
#Increase_coding_genes
temp <- res.deseq2[gene_type == 'protein_coding' & regulation == 'Increase' & seqnames != 'chrM',] %>% makeGRangesFromDataFrame()
GROPlotonTemp(temp,'Increase_TSS','Increase_protein_coding_genes','figures/GRO-seq_on_Increase_TSS.jpg')
ChIPPlotonTemp(temp,'H3K27ac','Increase_TSS','H3K27ac_Increase_protein_coding_genes','figures/H3K27ac_on_Increase_TSS.jpg')
ChIPPlotonTemp(temp,'H3K4me1','Increase_TSS','H3K4me1_Increase_protein_coding_genes','figures/H3K4me1_on_Increase_TSS.jpg')
ChIPPlotonTemp(temp,'Pol2','Increase_TSS','Pol2_Increase_protein_coding_genes','figures/Pol2_on_Increase_TSS.jpg')
#Decrease_coding_genes
temp <- res.deseq2[gene_type == 'protein_coding' & regulation == 'Decrease' & seqnames != 'chrM',] %>% makeGRangesFromDataFrame()
GROPlotonTemp(temp,'Decrease_TSS','Decrease_protein_coding_genes','figures/GRO-seq_on_Decrease_TSS.jpg')
ChIPPlotonTemp(temp,'H3K27ac','Decrease_TSS','H3K27ac_Decrease_protein_coding_genes','figures/H3K27ac_on_Decrease_TSS.jpg')
ChIPPlotonTemp(temp,'H3K4me1','Decrease_TSS','H3K4me1_Decrease_protein_coding_genes','figures/H3K4me1_on_Decrease_TSS.jpg')
ChIPPlotonTemp(temp,'Pol2','Decrease_TSS','Pol2_Decrease_protein_coding_genes','figures/Pol2_on_Decrease_TSS.jpg')
# Differences in Gene fetures_length_exons --------------------------------
#RPKM
plot.table <- res.deseq2[gene_type == 'protein_coding' & seqnames != 'chrM',]
# ChIAPET_analysis --------------------------------------------------------
interaction <- fread('coordinates/Hela_hg19.ChromatinInteractons.bed')
# ChIAPET_analysis --------------------------------------------------------
interaction <- fread('coordinates/Hela_hg19.ChromatinInteractons.bed', fill = T)
?fread
# ChIAPET_analysis --------------------------------------------------------
interaction <- fread('coordinates/Hela_hg19.ChromatinInteractons.bed', sep = '\t', header = F)
head(interaction)
?seq
seq(100, by =2)
seq(to =100, by =2)
interaction.left <- interaction[seq(to = nrow(interaction), by = 2),]
interaction.left <- interaction[seq(from =2 ,to = nrow(interaction), by = 2),]
interaction.left <- interaction[seq(to = nrow(interaction), by = 2),]
interaction.right <- interaction[seq(from =2 ,to = nrow(interaction), by = 2),]
interaction.left[1]
interaction.right[1]
tail(interaction)
interaction <- interaction$V4 %>% unique()
interaction.left <- str_extract(interaction,'.*-')
head(interaction.left)
?nearest
# Nearest -----------------------------------------------------------------
enhancers <- res.deseq2[gene_type == 'enhancer',] %>% makeGRangesFromDataFrame(keep.extra.columns = T)
genes <- res.deseq2[gene_type == 'protein_coding',] %>% makeGRangesFromDataFrame(keep.extra.columns = T)
enhancers[enhancers$regulation == 'Increase'] %>% head()
tail(nearest(enhancers,genes))
tail(enhancers)
tail(genes)
genes[4451]
temp <- genes[nearest(enhancers[enhancers$regulation == 'NC'],genes)]
table(temp$regulation)
temp <- genes[nearest(enhancers[enhancers$regulation == 'Increase'],genes)]
table(temp$regulation)
temp <- genes[nearest(enhancers[enhancers$regulation == 'Decrease'],genes)]
table(temp$regulation)
#Enhancer part.
GROPlotonTemp <- function(gr,inputfix,name,figurefile){
Direction2Gene(paste0('matrix/Hela-siCTL-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siCTL-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siCTL-rpt1')
Direction2Gene(paste0('matrix/Hela-siTIP60-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siTIP60-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siTIP60-rpt1')
plot.dt <- data.table(siCTL = colSums(`siCTL-rpt1.sense.mx`)/length(temp),
siCTL_AS = -colSums(`siCTL-rpt1.antisense.mx`)/length(temp),
siTIP60 = colSums(`siTIP60-rpt1.sense.mx`)/length(temp),
siTIP_AS = -colSums(`siTIP60-rpt1.antisense.mx`)/length(temp))
MxProfilePlot(plot.dt, breaks =c(1,61,120),labels = c('-1.5kb','center','1.5kb')) +
scale_color_manual(values = c('firebrick2','firebrick3','royalblue2','royalblue3'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
ChIPPlotonTemp <- function(temp,antibody,inputfix,name,figurefile){
siCTL.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siCTL_',inputfix,'_scaled.mx'))
siTIP60.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siTIP60_',inputfix,'_scaled.mx'))
index <- as.data.table(temp)$seqnames != 'chrM'
plot.dt <- data.table(siCTL = colSums(siCTL.mx[index,])/length(temp[index]),
siTIP60 = colSums(siTIP60.mx[index,])/length(temp[index]))
MxProfilePlot(plot.dt, breaks =c(1,61,120),labels = c('-1.5kb','center','1.5kb')) +
scale_color_manual(values = c('firebrick2','royalblue2'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
temp <- res.deseq2[gene_type == 'enhancer' & regulation == 'Decrease',] %>% makeGRangesFromDataFrame()
GROPlotonTemp(temp,'Decrease_enhancer','Decrease_enhancer_eRNAs','figures/GRO-seq_on_Decrease_enhancers.jpg')
ChIPPlotonTemp(temp,'H3K27ac','Decrease_enhancer','H3K27ac_Decrease_enhancer_eRNAs','figures/H3K27ac_on_Decrease_enhancers.jpg')
ChIPPlotonTemp(temp,'H3K4me1','Decrease_enhancer','H3K4me1_Decrease_enhancer_eRNAs','figures/H3K4me1_on_Decrease_enhancers.jpg')
ChIPPlotonTemp(temp,'Pol2','Decrease_enhancer','Pol2_Decrease_enhancer_eRNAs','figures/Pol2_on_Decrease_enhancers.jpg')
temp <- genes[nearest(enhancers[enhancers$regulation == 'NC'],genes)]$regulation %>% table
temp
temp <- genes[nearest(enhancers[enhancers$regulation == 'Increase'],genes)]$regulation %>% table
temp <- genes[nearest(enhancers[enhancers$regulation == 'Decrease'],genes)]$regulation %>% table
temp <- genes[nearest(enhancers[enhancers$regulation == 'NC'],genes)]$regulation %>% table
temp1 <- genes[nearest(enhancers[enhancers$regulation == 'Increase'],genes)]$regulation %>% table
temp2 <- genes[nearest(enhancers[enhancers$regulation == 'Decrease'],genes)]$regulation %>% table
class(temp)
rbind(temp,temp1)
count <- rbind(NC.e = temp, Increase.e = temp1, Decrease.e = temp2)
count
count <- rbind(NC.e = temp, Increase.e = temp1, Decrease.e = temp2) %>% as.data.table()
count[,sum := rowSums(count)]
count
count <- rbind(NC.e = temp, Increase.e = temp1, Decrease.e = temp2) %>% as.data.table()
count[,`:=`(enhancer = rownames(count) , sum = rowSums(count))]
count
temp <- genes[nearest(enhancers[enhancers$regulation == 'NC'],genes)]$regulation %>% table
temp1 <- genes[nearest(enhancers[enhancers$regulation == 'Increase'],genes)]$regulation %>% table
temp2 <- genes[nearest(enhancers[enhancers$regulation == 'Decrease'],genes)]$regulation %>% table
count <- rbind(NC.e = temp, Increase.e = temp1, Decrease.e = temp2) %>% as.data.table()
temp <- genes[nearest(enhancers[enhancers$regulation == 'NC'],genes)]$regulation %>% table
count
count[,`:=`(enhancer = rownames(count) , sum = rowSums(count))]
count
temp <- genes[nearest(enhancers[enhancers$regulation == 'NC'],genes)]$regulation %>% table
temp1 <- genes[nearest(enhancers[enhancers$regulation == 'Increase'],genes)]$regulation %>% table
temp2 <- genes[nearest(enhancers[enhancers$regulation == 'Decrease'],genes)]$regulation %>% table
count <- rbind(NC.e = temp, Increase.e = temp1, Decrease.e = temp2) %>% as.data.table()
count
count <- rbind(NC.e = temp, Increase.e = temp1, Decrease.e = temp2)
count[,`:=`(enhancer = c('NC','Increase','Decrease') , sum = rowSums(count))]
temp <- genes[nearest(enhancers[enhancers$regulation == 'NC'],genes)]$regulation %>% table
temp1 <- genes[nearest(enhancers[enhancers$regulation == 'Increase'],genes)]$regulation %>% table
temp2 <- genes[nearest(enhancers[enhancers$regulation == 'Decrease'],genes)]$regulation %>% table
count <- rbind(NC.e = temp, Increase.e = temp1, Decrease.e = temp2) %>% as.data.table()
count[,`:=`(enhancer = c('NC','Increase','Decrease') , sum = rowSums(count))]
count
count[,`:=`(Increase = round(Increase/sum,2),
Decrease = round(Decrease/sum,2),
NC = round(NC/sum,2))]
count
count <- melt(count, id.vars = c('enhancer','sum'))
count
count[,`:=`(enhancer := factor(enhancer, levels = c('Increase','NC','Decrease')),
variable := factor(variable, levels = c('Increase','NC','Decrease')))]
count <- rbind(NC.e = temp, Increase.e = temp1, Decrease.e = temp2) %>% as.data.table()
count[,`:=`(enhancer = c('NC','Increase','Decrease') , sum = rowSums(count))]
count[,`:=`(Increase = round(Increase/sum,2),
Decrease = round(Decrease/sum,2),
NC = round(NC/sum,2))]
count <- melt(count, id.vars = c('enhancer','sum'))
count[,`:=`(enhancer := factor(enhancer, levels = c('Increase','NC','Decrease')),
variable := factor(variable, levels = c('Increase','NC','Decrease')))]
count[,`:=`(enhancer = factor(enhancer, levels = c('Increase','NC','Decrease')),
variable = factor(variable, levels = c('Increase','NC','Decrease')))]
count
plot.table <- ggplot(count, aes(x = enhancer,y=value, color = variable))
p <- ggplot(count, aes(x = enhancer,y=value, color = variable))
p + geom_bar()
p + geom_bar(stat = 'identity')
p <- ggplot(count, aes(x = enhancer,y=value, fill = variable))
p + geom_bar(stat = 'identity')
p + geom_bar(stat = 'identity',width = 0.8)
p + geom_bar(stat = 'identity',width = 0.8) + theme_xf
p + geom_bar(stat = 'identity',width = 0.5) + theme_xf
temp <- genes[nearest(enhancers[enhancers$regulation == 'NC'],genes)]$regulation %>% table
temp1 <- genes[nearest(enhancers[enhancers$regulation == 'Increase'],genes)]$regulation %>% table
temp2 <- genes[nearest(enhancers[enhancers$regulation == 'Decrease'],genes)]$regulation %>% table
count <- rbind(NC.e = temp, Increase.e = temp1, Decrease.e = temp2) %>% as.data.table()
count[,`:=`(enhancer = c('NC','Increase','Decrease') , sum = rowSums(count))/100]
count[,`:=`(Increase = round(Increase/sum,2),
Decrease = round(Decrease/sum,2),
NC = round(NC/sum,2))]
count <- melt(count, id.vars = c('enhancer','sum'))
temp <- genes[nearest(enhancers[enhancers$regulation == 'NC'],genes)]$regulation %>% table
temp1 <- genes[nearest(enhancers[enhancers$regulation == 'Increase'],genes)]$regulation %>% table
temp2 <- genes[nearest(enhancers[enhancers$regulation == 'Decrease'],genes)]$regulation %>% table
count <- rbind(NC.e = temp, Increase.e = temp1, Decrease.e = temp2) %>% as.data.table()
count[,`:=`(enhancer = c('NC','Increase','Decrease') , sum = rowSums(count))/100]
temp <- genes[nearest(enhancers[enhancers$regulation == 'NC'],genes)]$regulation %>% table
temp1 <- genes[nearest(enhancers[enhancers$regulation == 'Increase'],genes)]$regulation %>% table
temp2 <- genes[nearest(enhancers[enhancers$regulation == 'Decrease'],genes)]$regulation %>% table
count <- rbind(NC.e = temp, Increase.e = temp1, Decrease.e = temp2) %>% as.data.table()
count[,`:=`(enhancer = c('NC','Increase','Decrease') , sum = rowSums(count)/100)]
count[,`:=`(Increase = round(Increase/sum,2),
Decrease = round(Decrease/sum,2),
NC = round(NC/sum,2))]
count <- melt(count, id.vars = c('enhancer','sum'))
count[,`:=`(enhancer = factor(enhancer, levels = c('Increase','NC','Decrease')),
variable = factor(variable, levels = c('Increase','NC','Decrease')))]
p <- ggplot(count, aes(x = enhancer,y=value, fill = variable))
p + geom_bar(stat = 'identity',width = 0.5) + theme_xf
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(vjust = 0.1) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers') +
# ChIAPET_analysis --------------------------------------------------------
interaction <- fread('coordinates/Hela_hg19.ChromatinInteractons.bed', sep = '\t', header = F)
p <- ggplot(count, aes(x = enhancer,y=value, fill = variable, label = sum))
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(vjust = 0.1) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers') +
# ChIAPET_analysis --------------------------------------------------------
interaction <- fread('coordinates/Hela_hg19.ChromatinInteractons.bed', sep = '\t', header = F)
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(vjust = 0.1) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers')
count
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(y = 100, vjust = 0.1) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers')
p <- ggplot(count, aes(x = enhancer,y=value, fill = variable, label = sum*100))
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(y = 100, vjust = 0.1) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers')
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(y = 100, vjust = 0.15) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers')
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(y = 100, vjust = 0.15, size = 2) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers')
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(y = 100, vjust = 0.15, size = 5) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers')
?scale_x_discrete
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(y = 100, vjust = 0.15, size = 5) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers') +
scale_x_discrete(labels = c('Genes near increase enhancer',
'Genes near NC enhancer',
'Genes near Decrease enhancer'))
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(y = 100, vjust = 0.15, size = 5) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers') +
scale_x_discrete(labels = c('Genes near increase enhancer',
'Genes near NC enhancer',
'Genes near Decrease enhancer')) +
theme(axis.text.x = element_text(angle = 50, vjust = -1))
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(y = 100, vjust = 0.15, size = 5) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers') +
scale_x_discrete(labels = c('Genes near increase enhancer',
'Genes near NC enhancer',
'Genes near Decrease enhancer')) +
theme(axis.text.x = element_text(angle = 50, hjust = 1))
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(y = 100, vjust = 0.15, size = 5) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers') +
scale_x_discrete(labels = c('Genes near increase enhancer',
'Genes near NC enhancer',
'Genes near Decrease enhancer')) +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(y = 100, vjust = 0.15, size = 5) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers') +
scale_x_discrete(labels = c('Genes near \n increase enhancer',
'Genes near \n NC enhancer',
'Genes near \n Decrease enhancer')) +
theme(axis.text.x = element_text(angle = 90, hjust = 1))
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(y = 100, vjust = 0.15, size = 5) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers') +
scale_x_discrete(labels = c('Genes near \n increase enhancer',
'Genes near \n NC enhancer',
'Genes near \n Decrease enhancer'))
ggsave(filename = 'figures/Genes_near_enhancers.jpg', width = 8, height = 8, dpi = 150, units = 'in')
length(inhancers)
length(enhancers)
table(enhancers$regulation)
temp <- genes[unique(nearest(enhancers[enhancers$regulation == 'NC'],genes))]$regulation %>% table
temp1 <- genes[unique(nearest(enhancers[enhancers$regulation == 'Increase'],genes))]$regulation %>% table
temp2 <- genes[unique(nearest(enhancers[enhancers$regulation == 'Decrease'],genes))]$regulation %>% table
count <- rbind(NC.e = temp, Increase.e = temp1, Decrease.e = temp2) %>% as.data.table()
count[,`:=`(enhancer = c('NC','Increase','Decrease') , sum = rowSums(count)/100)]
count[,`:=`(Increase = round(Increase/sum,2),
Decrease = round(Decrease/sum,2),
NC = round(NC/sum,2))]
count <- melt(count, id.vars = c('enhancer','sum'))
count[,`:=`(enhancer = factor(enhancer, levels = c('Increase','NC','Decrease')),
variable = factor(variable, levels = c('Increase','NC','Decrease')))]
p <- ggplot(count, aes(x = enhancer,y=value, fill = variable, label = sum*100))
p + geom_bar(stat = 'identity',width = 0.5) +
geom_text(y = 100, vjust = 0.15, size = 5) + theme_xf +
labs(x = NULL, y = 'percentage', title = 'Change of gene near enhancers') +
scale_x_discrete(labels = c('Genes near \n increase enhancer',
'Genes near \n NC enhancer',
'Genes near \n Decrease enhancer'))
ggsave(filename = 'figures/Genes_near_enhancers.jpg', width = 8, height = 8, dpi = 150, units = 'in')
# ChIAPET_analysis --------------------------------------------------------
interaction <- fread('coordinates/Hela_hg19.ChromatinInteractons.bed', sep = '\t', header = F)
# ChIAPET_analysis --------------------------------------------------------
interaction <- fread('coordinates/Hela_hg19.ChromatinInteractons.bed', sep = '\t', header = F)
interaction <- interaction$V4 %>% unique()
interaction.left <- str_extract(interaction,'.*-')
head(interaction.left)
interaction.left <- data.table(chr = str_extract(interaction.left, 'chr\\d*'),
start = str_replace(str_extract(interaction.left,':\\d*'),":",""),
end = str_replace(str_extract(interaction.left,'\\d*-'),"-",""))
head(interaction.left)
interaction <- interaction$V4 %>% unique()
interaction.left <- str_extract(interaction,'.*-')
# ChIAPET_analysis --------------------------------------------------------
interaction <- fread('coordinates/Hela_hg19.ChromatinInteractons.bed', sep = '\t', header = F)
interaction <- interaction$V4 %>% unique()
interaction.left <- str_extract(interaction,'.*-')
interaction.left <- data.table(chr = str_extract(interaction.left, 'chr\\d*'),
start = str_replace(str_extract(interaction.left,':\\d*'),":",""),
end = str_replace(str_extract(interaction.left,'\\d*-'),"-","")) %>% makeGRangesFromDataFrame()
head(interaction)
interaction.right <- str_extract(interaction,'-.*')
head(interaction.right)
interaction.right <- data.table(chr = str_extract(interaction.right, 'chr\\d*'),
start = str_replace(str_extract(interaction.right,':\\d*'),":",""),
end = str_replace(str_extract(interaction.right,'\\d*,'),",","")) %>% makeGRangesFromDataFrame()
head(interaction.right)
findOverlaps(interaction.left,interaction.right)
length(interaction)
length(interaction.left)
interaction.left[11]
interaction.right[30457]
test <- findOverlaps(interaction.left,enhancers) %>% from
head(interaction.left)
unique(test) %>% length()
length(interaction.left)
seqinfo(interaction.left)
interaction.left <- str_extract(interaction,'.*-')
interaction.left <- data.table(chr = str_extract(interaction.left, 'chr\\[\\d*\\|X\\|Y\\]'),
start = str_replace(str_extract(interaction.left,':\\d*'),":",""),
end = str_replace(str_extract(interaction.left,'\\d*-'),"-","")) %>% makeGRangesFromDataFrame()
interaction.left <- str_extract(interaction,'.*-')
interaction.left <- data.table(chr = str_extract(interaction.left, 'chr[\\d*|X|Y]'),
start = str_replace(str_extract(interaction.left,':\\d*'),":",""),
end = str_replace(str_extract(interaction.left,'\\d*-'),"-","")) %>% makeGRangesFromDataFrame()
seqinfo(interaction.left)
head(interaction)
interaction.left <- str_extract(interaction,'.*-')
interaction.left <- data.table(chr = str_replace(str_extract(interaction.left, 'chr.*:'),':',''),
start = str_replace(str_extract(interaction.left,':\\d*'),":",""),
end = str_replace(str_extract(interaction.left,'\\d*-'),"-","")) %>% makeGRangesFromDataFrame()
seqinfo(interaction.left)
interaction.left <- str_extract(interaction,'.*-')
interaction.left <- data.table(chr = str_replace(str_extract(interaction.left, 'chr.*:'),':',''),
start = str_replace(str_extract(interaction.left,':\\d*'),":",""),
end = str_replace(str_extract(interaction.left,'\\d*-'),"-","")) %>% makeGRangesFromDataFrame()
interaction.right <- str_extract(interaction,'-.*')
interaction.right <- data.table(chr = str_replace(str_extract(interaction.left, 'chr.*:'),':',''),
start = str_replace(str_extract(interaction.right,':\\d*'),":",""),
end = str_replace(str_extract(interaction.right,'\\d*,'),",","")) %>% makeGRangesFromDataFrame()
paste0('P',NA)
paste0(c('E','P'),c(NA,NA))
promoters(genes) %>% head()
count <- data.table(left = rep(NA,length(interaction.left)), right = rep(NA, length(interaction.right)))
count[unique(from(findOverlaps(interaction.left,enhancers))),left := 'E']
unique(from(findOverlaps(interaction.left,enhancers))) %>% head()
count$left[unique(from(findOverlaps(interaction.left,enhancers)))] <- 'E'
count$left[unique(from(findOverlaps(interaction.left,promoters(genes))))] <- 'P'
count$left[unique(from(findOverlaps(interaction.left,enhancers)))] <- 'E'
count$left[unique(from(findOverlaps(interaction.left,promoters(genes))))] <- 'P'
count$right[unique(from(findOverlaps(interaction.right,enhancers)))] <- 'E'
count$right[unique(from(findOverlaps(interaction.right,promoters(genes))))] <- 'P'
table(count$left)
table(count$right)
count <- data.table(left = rep(NA,length(interaction.left)), right = rep(NA, length(interaction.right)))
head(count)
count$left[unique(from(findOverlaps(interaction.left,enhancers)))] <- 'E'
count$left[unique(from(findOverlaps(interaction.left,promoters(genes))))] <- 'P'
count$right[unique(from(findOverlaps(interaction.right,enhancers)))] <- 'E'
count$right[unique(from(findOverlaps(interaction.right,promoters(genes))))] <- 'P'
head(count)
count[,type:=paste0(left,'-',right)]
table(count$type)
count[type = 'P-E', type:= 'E-P']
count[type = 'NA-P', type:= 'P-NA']
count[type == 'P-E', type:= 'E-P']
count[type == 'NA-P', type:= 'P-NA']
count[type == 'NA-E', type:= 'E-NA']
table(count)
table(count$type)
plot.table <- count[,.(.N),by = type]
plot.table
plot.table$type <- factor(plot.table$type,levels = c('E-P','E-E','P-P','E-NA','P-NA','NA-NA'))
p <- plot_ly(count,labels = ~type, values = ~N, type = 'pie',
textposition = 'outside',
textinfo = 'percent',
marker = list(colors = colors,
line = list(color = '#FFFFFF',
width = 1)))
p <- layout(p,
title = 'Distribution of GRO-seq reads on genomic elements',
margin = list(l=100,t=80,b=50),
showlegend = T)
library(plotly)
plot.table$type <- factor(plot.table$type,levels = c('E-P','E-E','P-P','E-NA','P-NA','NA-NA'))
p <- plot_ly(count,labels = ~type, values = ~N, type = 'pie',
textposition = 'outside',
textinfo = 'percent',
marker = list(colors = colors,
line = list(color = '#FFFFFF',
width = 1)))
p <- layout(p,
title = 'type of ChIA-PET interactions',
margin = list(l=100,t=80,b=50),
showlegend = T)
p
plot.table <- count[,.(.N),by = type]
plot.table$type <- factor(plot.table$type,levels = c('E-P','E-E','P-P','E-NA','P-NA','NA-NA'))
p <- plot_ly(count,labels = ~type, values = ~N, type = 'pie',
textposition = 'outside',
textinfo = 'percent',
marker = list(colors = colors,
line = list(color = '#FFFFFF',
width = 1)))
p <- layout(p,
title = 'type of ChIA-PET interactions',
margin = list(l=100,t=80,b=50),
showlegend = T)
p
plot.table
colnames(plot.table) <- c('type','count')
plot.table <- count[,.(.N),by = type]
colnames(plot.table) <- c('type','count')
plot.table$type <- factor(plot.table$type,levels = c('E-P','E-E','P-P','E-NA','P-NA','NA-NA'))
p <- plot_ly(count,labels = ~type, values = ~count, type = 'pie',
textposition = 'outside',
textinfo = 'percent',
marker = list(colors = colors,
line = list(color = '#FFFFFF',
width = 1)))
p <- layout(p,
title = 'type of ChIA-PET interactions',
margin = list(l=100,t=80,b=50),
showlegend = T)
p
plotly_IMAGE(p, width = 700, height = 700, out_file = 'figures/test.png')
#If error, need:
Sys.setenv("plotly_username"="Feng_Xiong")
Sys.setenv("plotly_api_key"="cKUazDNFFbwzc7m8EGdj")
plotly_IMAGE(p, width = 700, height = 700, out_file = 'figures/test.png')
?pie
pie(plot.table$count,labels = plot.table$type)
pie(plot.table$count,labels = paste0(plot.table$type,count))
pie(plot.table$count,labels = paste0(plot.table$type,plot.table$count))
pie(plot.table$count,labels = paste0(plot.table$type,'(',plot.table$count),')')
pie(plot.table$count,labels = paste0(plot.table$type,'(',plot.table$count,')'))
plot.table <- count[,.(.N),by = type]
colnames(plot.table) <- c('type','count')
plot.table$type <- factor(plot.table$type,levels = c('E-P','E-E','P-P','E-NA','P-NA','NA-NA'))
p <- plot_ly(count,labels = ~type, values = ~count, type = 'pie',
textposition = 'outside',
textinfo = 'percent',
marker = list(colors = colors,
line = list(color = '#FFFFFF',
width = 1)))
p <- layout(p,
title = 'type of ChIA-PET interactions',
margin = list(l=100,t=80,b=50),
showlegend = T)
p
p <- layout(p,
title = 'type of ChIA-PET interactions')
p
p <- plot_ly(plot.table,labels = ~type, values = ~count, type = 'pie',
textposition = 'outside',
textinfo = 'percent',
marker = list(colors = colors,
line = list(color = '#FFFFFF',
width = 1)))
p <- layout(p,
title = 'type of ChIA-PET interactions')
p
p <- plot_ly(plot.table,labels = ~type, values = ~count, type = 'pie',
textposition = 'outside',
textinfo = 'percent + label + value',
marker = list(colors = colors,
line = list(color = '#FFFFFF',
width = 1)))
p <- layout(p,
title = 'type of ChIA-PET interactions')
p
p <- plot_ly(plot.table,labels = ~type, values = ~count, type = 'pie',
textposition = 'outside',
textinfo = 'percent +label+value',
marker = list(colors = colors,
line = list(color = '#FFFFFF',
width = 1)))
p <- layout(p,
title = 'type of ChIA-PET interactions')
p
p <- plot_ly(plot.table,labels = ~type, values = ~count, type = 'pie',
textposition = 'outside',
textinfo = 'percent+label+value',
marker = list(colors = colors,
line = list(color = '#FFFFFF',
width = 1)))
p <- layout(p,
title = 'type of ChIA-PET interactions')
p
plotly_IMAGE(p, width = 700, height = 700, out_file = 'figures/test.png')
p <- layout(p,
title = 'type of ChIA-PET interactions',
margin = list(l=100,t=80,b=100),
showlegend = T)
p
plotly_IMAGE(p, width = 700, height = 700, out_file = 'figures/ChIA-PET_interaction.png')
head(count)
length(count)
nrow(count)
# Load packages and functions needed ---------------------------------------------------
library(GenomicRanges)
library(magrittr)
library(ggplot2)
library(data.table)
library(RColorBrewer)
library(stringr)
require(TxDb.Hsapiens.UCSC.hg19.knownGene)
require(org.Hs.eg.db)
