setwd("G:/My Drive/TMC_WenboLi/Data/Bioinformatic/P400_TIP60_diffgene_analysis")
source('~/.active-rstudio-document')
library(GenomicRanges)
library(magrittr)
library(ggplot2)
library(data.table)
setwd("C:/Feng/Groseq_pipeline/groseq_pipe_line")
setwd("C:/Feng/Groseq_pipeline")
load('r.func/ImportBiopacks.rdata')
ImportBiopacks('GenomicRanges')
install.packages('MASS')
# Library -----------------------------------------------------------------
library(GenomicRanges)
def.exp.p400 <- fread('P400.diffoutput.txt')
rm(def.exp.p400)
dif.exp.p400 <- fread('P400.diffoutput.txt')
View(dif.exp.p400)
file = 'P400.diffoutput.txt'
coordinate = 'coordinates/gencode.v19.annotation.geneonly.gtf'
rm(dif.exp.p400)
dif.exp <- fread(file)
coordinate <- fread(coordinate.file) %>% makeGRangesFromDataFrame()
coordinate.file = 'coordinates/gencode.v19.annotation.geneonly.gtf'
coordinate <- fread(coordinate.file) %>% makeGRangesFromDataFrame()
coordinate <- fread(coordinate.file)
head(coordinate)
coordinate <- fread(coordinate.file) %>% `colnames<-`(c('seqname','source','feature','start','end','score','strand','frame','attribute'))
coordinate <- makeGRangesFromDataFrame(coordinate)
head(coordinate)
coordinate <- fread(coordinate.file) %>% `colnames<-`(c('seqname','source','feature','start','end','score','strand','frame','attribute'))
coordinate <- makeGRangesFromDataFrame(coordinate,keep.extra.columns = T)
head(coordinate)
attribute.type <- strsplit(coordinate$attribute[1],';')
attribute.type
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist()
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace_all(' \\"\\.*\\"','')
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace(' \\"\\.*\\"','')
library(stringr)
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace(' \\"\\.*\\"','')
attribute.type
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace_all('\\"\\.*\\"','')
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace_all('\\".*\\"','')
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace_all( '\\".*\\"','')
attribute.type
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace_all( '\\".*\\"','') %>% str_replace_all(' ','')
i <- "gene_id"
str_extract('aabaac','a\\w')
str_extract('aabaac','aa\\w')
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace_all( '\\".*\\"','')
i <- "gene_id "
temp <- str_extract(coordinate$attribute,paste0(i,'\\".*;'))
temp %>% head()
temp <- str_extract(coordinate$attribute,paste0(i,'\\".*ï¼Ÿ;'))
temp <- str_extract(coordinate$attribute,paste0(i,'\\".*?;'))
temp %>% head()
temp <- str_extract(coordinate$attribute,paste0(i,'\\".*?;')) %>% str_replace_all(i,'') %>% str_replace_all('\"','') %>% str_replace_all(' ','')
temp %>% head()
temp <- str_extract(coordinate$attribute,paste0(i,'\\".*?;')) %>%
str_replace_all(i,'') %>%
str_replace_all('\"','') %>%
str_replace_all(';','') %>%
str_replace_all(' ','')
attribute.type <- strsplit(coordinate$attribute[1],';')
attribute.type
str_extract_all('aabbabac','a\\w')
attribute.list <- list(NULL)
attribute <- list(NULL)
for (i in seq(length(attribute.type))) {
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(i, '\\".*?;')) %>%
str_replace_all(i, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '')
attribute.list[[i]] <- temp
}
str_rname
name
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace_all( '\\".*\\"','')
attribute <- list(NULL)
for (i in seq(length(attribute.type))) {
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(i, '\\".*?;')) %>%
str_replace_all(i, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '')
attribute.list[[i]] <- temp
}
attribute.type
seq(length(attribute.type))
i <- 1
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(i, '\\".*?;')) %>%
str_replace_all(i, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '')
attribute <- list(NULL)
for (i in seq(length(attribute.type))) {
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(i, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '')
attribute.list[[i]] <- temp
}
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(i, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '')
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;'))
for (i in seq(length(attribute.type))) {
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(name, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '')
attribute.list[[i]] <- temp
}
attribute <- as.data.table(attribute.list) %>% `colnames<-`(attribute.type)
View(attribute)
coordinate$attribute <- NULL
mcols(coordinate) <- cbind(mcols(coordinate), attribute)
head(coordinate)
colnames(attribute)
source('G:/My Drive/TMC_WenboLi/Data/Bioinformatic/P400_TIP60_diffgene_analysis/DiffGeneCat.R', echo=TRUE)
dif.exp <- fread(diff.file)
coordinate <- fread(coordinate.file) %>% `colnames<-`(c('seqname','source','feature','start','end','score','strand','frame','attribute'))
coordinate <- makeGRangesFromDataFrame(coordinate,keep.extra.columns = T)
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace_all( '\\".*\\"','')
attribute <- list(NULL)
for (i in seq(length(attribute.type))) {
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(name, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all('', '') %>%
str_replace_all('\\t','')
attribute.list[[i]] <- temp
}
for (i in seq(length(attribute.type))) {
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(name, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all('', '') %>%
str_replace_all('\\t','')
attribute[[i]] <- temp
}
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(name, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all('', '') %>%
str_replace_all('\\t','')
# Library -----------------------------------------------------------------
library(GenomicRanges)
library(magrittr)
library(ggplot2)
library(data.table)
library(RColorBrewer)
library(stringr)
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(name, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all('', '') %>%
str_replace_all('\\t','')
(NULL)
for (i in seq(length(attribute.type))) {
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(name, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '') %>%
str_replace_all('\\t','')
attribute[[i]] <- temp
}
attribute <- as.data.table(attribute.list) %>% `colnames<-`(attribute.type)
for (i in seq(length(attribute.type))) {
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(name, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '') %>%
attribute[[i]] <- temp
}
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace_all( '\\".*\\"','')
attribute <- list(NULL)
for (i in seq(length(attribute.type))) {
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(name, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '') %>%
attribute[[i]] <- temp
}
dif.exp <- fread(diff.file)
coordinate <- fread(coordinate.file) %>% `colnames<-`(c('seqname','source','feature','start','end','score','strand','frame','attribute'))
coordinate <- makeGRangesFromDataFrame(coordinate,keep.extra.columns = T)
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace_all( '\\".*\\"','')
attribute <- list(NULL)
for (i in seq(length(attribute.type))) {
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(name, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '') %>%
attribute[[i]] <- temp
}
for (i in seq(length(attribute.type))) {
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(name, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '')
attribute[[i]] <- temp
}
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(name, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '')
coordinate$attribute <- NULL
mcols(coordinate) <- cbind(mcols(coordinate), attribute)
head(coordinate)
str_replace_all(attribute.type,' ','')
attribute <- as.data.table(attribute) %>% `colnames<-`(str_replace_all(attribute.type,' ',''))
coordinate$attribute <- NULL
mcols(coordinate) <- cbind(mcols(coordinate), attribute)
head(coordinate)
head(diff.file)
head(diff.exp)
# Diff expression analysis (start from homer diff output) -----------------
dif.exp <- fread(diff.file)
head(diff.exp)
head(dif.exp)
Info <- dif.exp %>% colnames() %>% `[`(1)
Info <- colnames(dif.exp)[1]
dif.exp <- makeGRangesFromDataFrame(dif.exp,keep.extra.columns = T)
head(dif.exp)
# Diff expression analysis (start from homer diff output) -----------------
dif.exp <- fread(diff.file)
Info <- colnames(dif.exp)[1]
dif.exp[1] <- NULL
dif.exp <- makeGRangesFromDataFrame(dif.exp,keep.extra.columns = T)
dif.exp[1,] <- NULL
dif.exp[,1] <- NULL
# Diff expression analysis (start from homer diff output) -----------------
dif.exp <- fread(diff.file)
Info <- colnames(dif.exp)[1]
dif.exp[,1]
dif.exp[,-1]
dif.exp <- makeGRangesFromDataFrame(dif.exp[,-1],keep.extra.columns = T)
?merge
dif.exp <- makeGRangesFromDataFrame(dif.exp[,-1],keep.extra.columns = T) %>% sort()
coordinate <- coordinate %>% sort()
head(coordinate)
# Change coordinate to GR -------------------------------------------------
coordinate <- fread(coordinate.file) %>% `colnames<-`(c('seqname','source','feature','start','end','score','strand','frame','attribute'))
coordinate <- makeGRangesFromDataFrame(coordinate,keep.extra.columns = T) %>% sort()
attribute.type <- strsplit(coordinate$attribute[1],';') %>% unlist() %>% str_replace_all( '\\".*\\"','')
attribute <- list(NULL)
for (i in seq(length(attribute.type))) {
name <- attribute.type[i]
temp <- str_extract(coordinate$attribute, paste0(name, '\\".*?;')) %>%
str_replace_all(name, '') %>%
str_replace_all('\"', '') %>%
str_replace_all(';', '') %>%
str_replace_all(' ', '')
attribute[[i]] <- temp
}
attribute <- as.data.table(attribute) %>% `colnames<-`(str_replace_all(attribute.type,' ',''))
coordinate$attribute <- NULL
head(attribute)
mcols(coordinate) <- cbind(mcols(coordinate), attribute)
head(coordinate)
head(dif.exp)
table(coordinate$gene_type)
