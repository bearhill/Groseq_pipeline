temp <- AnnotationDbi::select(org.Hs.eg.db,plot.table$gene_name,'ENTREZID',keytype = 'SYMBOL')
plot.table <- merge(plot.table, temp,by.x = 'gene_name',by.y ='SYMBOL',all.x = F,all.y =F)
str(plot.table$ENTREZID)
str(exon.count$ENTREZID)
plot.table <- res.deseq2[gene_type == 'protein_coding',]
temp <- AnnotationDbi::select(org.Hs.eg.db,plot.table$gene_name,'ENTREZID',keytype = 'SYMBOL')
plot.table <- merge(plot.table, temp,by.x = 'gene_name',by.y ='SYMBOL',all.x = F,all.y =F)
plot.table <- merge(plot.table,exon.count,by = 'ENTREZID',all.x = T, all.y = F)
library(dplyr)
test <- select(plot.table,contains('Homer'))
test
head(plot.table)
test <- select(plot.table,contains('Homer')) %>% rowSums()*10E9/(plot.table$width*total.reads)
plot.table <- res.deseq2[gene_type == 'protein_coding',]
temp <- AnnotationDbi::select(org.Hs.eg.db,plot.table$gene_name,'ENTREZID',keytype = 'SYMBOL')
plot.table <- merge(plot.table, temp,by.x = 'gene_name',by.y ='SYMBOL',all.x = F,all.y =F)
plot.table <- merge(plot.table,exon.count,by = 'ENTREZID',all.x = T, all.y = F)
plot.table <- select(plot.table,contains('Homer')) %>% rowSums()*10E9/(plot.table$width*total.reads)
plot.table <- res.deseq2[gene_type == 'protein_coding',]
temp <- AnnotationDbi::select(org.Hs.eg.db,plot.table$gene_name,'ENTREZID',keytype = 'SYMBOL')
plot.table <- merge(plot.table, temp,by.x = 'gene_name',by.y ='SYMBOL',all.x = F,all.y =F)
plot.table <- merge(plot.table,exon.count,by = 'ENTREZID',all.x = T, all.y = F)
plot.table$rpkm <- select(plot.table,contains('Homer')) %>% rowSums()*10E9/(plot.table$width*total.reads)
p <- ggplot(plot.table,aes(x= regulation, y = rpkm))
p + geom_boxplot()
p + geom_boxplot() + ylim(0,10)
p + geom_boxplot()
plot.table[rpkm > 3000,]
table(plot.table$seqnames)
seqinfo(transcripts.gr)
keepStandardChromosomes(transcripts.gr) %>% seqinfo()
colnames(plot.table)
p <- ggplot(plot.table,aes(x= regulation, y = exon.n))
p + geom_boxplot()
p + geom_boxplot() + ylim(0,50)
p <- ggplot(plot.table,aes(x= exon.n, y = log2FoldChange))
p + geom_boxplot()
p <- ggplot(plot.table,aes(x= as.factor(exon.n), y = log2FoldChange))
p + geom_boxplot()
length(transcripts.gr)
dropSeqlevels(transcripts.gr,'chrM') %>% length()
transcripts.gr <- GTF2GR('coordinates/Hela.transcripts.all.gtf') %>% dropSeqlevels('chrM')
counttable <- fread(counttable.raw.file)
counttable <- makeGRangesFromDataFrame(counttable[,-1],keep.extra.columns = T) %>% dropSeqlevels('chrM') %>% sort()
length(transcripts.gr)
transcripts.gr <- GTF2GR('coordinates/Hela.transcripts.all.gtf') %>% dropSeqlevels('chrM') %>% sort()
counttable <- fread(counttable.raw.file)
Info <- colnames(counttable)[1]
counttable <- makeGRangesFromDataFrame(counttable[,-1],keep.extra.columns = T) %>% dropSeqlevels('chrM') %>% sort()
counttable <- cbind(as.data.table(transcripts.gr),mcols(counttable)[,tail(seq(ncol(mcols(counttable))),groupn)]) %>% as.data.table()
head(counttable)
total.reads <- tail(colnames(counttable),groupn) %>% str_extract('\\d+\\.0') %>% as.numeric() %>% sum()
colnames(res.deseq2)
res.deseq2[seqnames == 'chrM',]
transcripts.gr <- GTF2GR('coordinates/Hela.transcripts.all.gtf') %>% sort()
counttable <- makeGRangesFromDataFrame(counttable[,-1],keep.extra.columns = T) %>%  sort()
counttable <- cbind(as.data.table(transcripts.gr),mcols(counttable)[,tail(seq(ncol(mcols(counttable))),groupn)]) %>% as.data.table()
transcripts.gr <- GTF2GR('coordinates/Hela.transcripts.all.gtf') %>% sort()
counttable <- fread(counttable.raw.file)
Info <- colnames(counttable)[1]
counttable <- makeGRangesFromDataFrame(counttable[,-1],keep.extra.columns = T) %>%sort()
counttable <- cbind(as.data.table(transcripts.gr),mcols(counttable)[,tail(seq(ncol(mcols(counttable))),groupn)]) %>% as.data.table()
total.reads <- tail(colnames(counttable),groupn) %>% str_extract('\\d+\\.0') %>% as.numeric() %>% sum()
temp <- counttable[,c(tail(colnames(counttable),groupn)),with = F] %>% rowSums()
genetype.info <- data.table(reads=temp,gene_type = counttable$gene_type)
genetype.info <- genetype.info[,.(readsperc= sum(reads)*100/total.reads,
count=.N),by = gene_type]
genetype.info <- genetype.info[order(readsperc)]
genetype.info
genetype.major <- genetype.info[readsperc > 0.001 & count > 200,][order(-count)]$gene_type %>% as.character()
genetype.info <- genetype.info[gene_type %in% genetype.major,]
genetype.info <- rbind(list('other',100-sum(genetype.info$readsperc),0),genetype.info)
genetype.info$gene_type <- factor(genetype.info$gene_type,levels = genetype.info$gene_type)
genetype.info[gene_type == 'other',count:=NA]
library(plotly)
plot.table <- genetype.info
plot.table$gene_type <- paste0(plot.table$gene_type,'(',plot.table$count,')')
p <- plot_ly(plot.table,labels = ~gene_type, values = ~readsperc, type = 'pie',
textposition = 'outside',
textinfo = 'percent',
marker = list(colors = colors,
line = list(color = '#FFFFFF',
width = 1)))
p <- layout(p,
title = 'Distribution of GRO-seq reads on genomic elements',
margin = list(l=100,t=80,b=50),
showlegend = T)
p
temp <- res.deseq2[gene_type == 'protein_coding' & regulation == 'NC',] %>% makeGRangesFromDataFrame()
seqinfo(temp)
seqnames(temp) == 'chrM'
temp[1]
index <- seqnames(temp) != 'chrM'
temp[index] %>% length()
length(temp)
GROPlotonTemp <- function(gr,inputfix,name,figurefile){
Direction2Gene(paste0('matrix/Hela-siCTL-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siCTL-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siCTL-rpt1')
Direction2Gene(paste0('matrix/Hela-siTIP60-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siTIP60-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siTIP60-rpt1')
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(`siCTL-rpt1.sense.mx`[index])/length(temp[index]),
siCTL_AS = -colSums(`siCTL-rpt1.antisense.mx`[index])/length(temp[index]),
siTIP60 = colSums(`siTIP60-rpt1.sense.mx`[index])/length(temp[index]),
siTIP_AS = -colSums(`siTIP60-rpt1.antisense.mx`[index])/length(temp)[index])
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','firebrick3','royalblue2','royalblue3'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
GROPlotonTemp <- function(gr,inputfix,name,figurefile){
Direction2Gene(paste0('matrix/Hela-siCTL-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siCTL-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siCTL-rpt1')
Direction2Gene(paste0('matrix/Hela-siTIP60-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siTIP60-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siTIP60-rpt1')
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(`siCTL-rpt1.sense.mx`[index])/length(temp[index]),
siCTL_AS = -colSums(`siCTL-rpt1.antisense.mx`[index])/length(temp[index]),
siTIP60 = colSums(`siTIP60-rpt1.sense.mx`[index])/length(temp[index]),
siTIP_AS = -colSums(`siTIP60-rpt1.antisense.mx`[index])/length(temp)[index])
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','firebrick3','royalblue2','royalblue3'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
GROPlotonTemp <- function(gr,inputfix,name,figurefile){
Direction2Gene(paste0('matrix/Hela-siCTL-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siCTL-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siCTL-rpt1')
Direction2Gene(paste0('matrix/Hela-siTIP60-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siTIP60-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siTIP60-rpt1')
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(`siCTL-rpt1.sense.mx`[index])/length(temp[index]),
siCTL_AS = -colSums(`siCTL-rpt1.antisense.mx`[index])/length(temp[index]),
siTIP60 = colSums(`siTIP60-rpt1.sense.mx`[index])/length(temp[index]),
siTIP_AS = -colSums(`siTIP60-rpt1.antisense.mx`[index])/length(temp)[index])
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','firebrick3','royalblue2','royalblue3'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
ChIPPlotonTemp <- function(temp,antibody,inputfix,name,figurefile){
siCTL.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siCTL_',inputfix,'_scaled.mx'))
siTIP60.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siTIP60_',inputfix,'_scaled.mx'))
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(siCTL.mx[index])/length(temp[index]),
siTIP60 = colSums(siTIP60.mx[index])/length(temp)[index])
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','royalblue2'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
GROPlotonTemp <- function(gr,inputfix,name,figurefile){
Direction2Gene(paste0('matrix/Hela-siCTL-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siCTL-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siCTL-rpt1')
Direction2Gene(paste0('matrix/Hela-siTIP60-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siTIP60-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siTIP60-rpt1')
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(`siCTL-rpt1.sense.mx`[index])/length(temp[index]),
siCTL_AS = -colSums(`siCTL-rpt1.antisense.mx`[index])/length(temp[index]),
siTIP60 = colSums(`siTIP60-rpt1.sense.mx`[index])/length(temp[index]),
siTIP_AS = -colSums(`siTIP60-rpt1.antisense.mx`[index])/length(temp)[index])
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','firebrick3','royalblue2','royalblue3'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
ChIPPlotonTemp <- function(temp,antibody,inputfix,name,figurefile){
siCTL.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siCTL_',inputfix,'_scaled.mx'))
siTIP60.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siTIP60_',inputfix,'_scaled.mx'))
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(siCTL.mx[index])/length(temp[index]),
siTIP60 = colSums(siTIP60.mx[index])/length(temp)[index])
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','royalblue2'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
temp <- res.deseq2[gene_type == 'protein_coding' & regulation == 'NC',] %>% makeGRangesFromDataFrame()
GROPlotonTemp(temp,'NC_genes','NC_protein_coding_genes','figures/GRO-seq_on_NC_protein_coding.jpg')
ChIPPlotonTemp(temp,'H3K27ac','NC_genes','H3K27ac_NC_protein_coding_genes','figures/H3K27ac_on_NC_protein_coding.jpg')
ChIPPlotonTemp(temp,'H3K4me1','NC_genes','H3K4me1_NC_protein_coding_genes','figures/H3K4me1_on_NC_protein_coding.jpg')
ChIPPlotonTemp(temp,'Pol2','NC_genes','Pol2_NC_protein_coding_genes','figures/Pol2_on_NC_protein_coding.jpg')
GROPlotonTemp <- function(gr,inputfix,name,figurefile){
Direction2Gene(paste0('matrix/Hela-siCTL-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siCTL-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siCTL-rpt1')
Direction2Gene(paste0('matrix/Hela-siTIP60-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siTIP60-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siTIP60-rpt1')
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(`siCTL-rpt1.sense.mx`[index,])/length(temp[index]),
siCTL_AS = -colSums(`siCTL-rpt1.antisense.mx`[index,])/length(temp[index]),
siTIP60 = colSums(`siTIP60-rpt1.sense.mx`[index,])/length(temp[index]),
siTIP_AS = -colSums(`siTIP60-rpt1.antisense.mx`[index,])/length(temp[index])
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','firebrick3','royalblue2','royalblue3'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
ChIPPlotonTemp <- function(temp,antibody,inputfix,name,figurefile){
siCTL.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siCTL_',inputfix,'_scaled.mx'))
siTIP60.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siTIP60_',inputfix,'_scaled.mx'))
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(siCTL.mx[index,])/length(temp[index]),
siTIP60 = colSums(siTIP60.mx[index,])/length(temp[index]))
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','royalblue2'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
#NC_coding_genes
temp <- res.deseq2[gene_type == 'protein_coding' & regulation == 'NC',] %>% makeGRangesFromDataFrame()
GR2BED(temp,'coordinates/NC_genes_siTIP60.bed')
GROPlotonTemp(temp,'NC_genes','NC_protein_coding_genes','figures/GRO-seq_on_NC_protein_coding.jpg')
GROPlotonTemp <- function(gr,inputfix,name,figurefile){
Direction2Gene(paste0('matrix/Hela-siCTL-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siCTL-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siCTL-rpt1')
Direction2Gene(paste0('matrix/Hela-siTIP60-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siTIP60-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siTIP60-rpt1')
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(`siCTL-rpt1.sense.mx`[index,])/length(temp[index]),
siCTL_AS = -colSums(`siCTL-rpt1.antisense.mx`[index,])/length(temp[index]),
siTIP60 = colSums(`siTIP60-rpt1.sense.mx`[index,])/length(temp[index]),
siTIP_AS = -colSums(`siTIP60-rpt1.antisense.mx`[index,])/length(temp[index]))
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','firebrick3','royalblue2','royalblue3'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
ChIPPlotonTemp <- function(temp,antibody,inputfix,name,figurefile){
siCTL.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siCTL_',inputfix,'_scaled.mx'))
siTIP60.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siTIP60_',inputfix,'_scaled.mx'))
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(siCTL.mx[index,])/length(temp[index]),
siTIP60 = colSums(siTIP60.mx[index,])/length(temp[index]))
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','royalblue2'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
temp <- res.deseq2[gene_type == 'protein_coding' & regulation == 'NC',] %>% makeGRangesFromDataFrame()
GROPlotonTemp(temp,'NC_genes','NC_protein_coding_genes','figures/GRO-seq_on_NC_protein_coding.jpg')
head(index)
test <- ReadMatrix('matrix/Hela-siCTL-rpt1-GROpos_NC_genes_scaled.mx)
)
000
''
"
q()
'
test <- ReadMatrix('matrix/Hela-siCTL-rpt1-GROpos_NC_genes_scaled.mx')
test[index,] %>% head
test[as.vector(index),] %>% head
index <- seqnames(temp) != 'chrM' %>% as.vector()
GROPlotonTemp <- function(gr,inputfix,name,figurefile){
Direction2Gene(paste0('matrix/Hela-siCTL-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siCTL-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siCTL-rpt1')
Direction2Gene(paste0('matrix/Hela-siTIP60-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siTIP60-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siTIP60-rpt1')
index <- seqnames(temp) != 'chrM' %>% as.vector()
plot.dt <- data.table(siCTL = colSums(`siCTL-rpt1.sense.mx`[index,])/length(temp[index]),
siCTL_AS = -colSums(`siCTL-rpt1.antisense.mx`[index,])/length(temp[index]),
siTIP60 = colSums(`siTIP60-rpt1.sense.mx`[index,])/length(temp[index]),
siTIP_AS = -colSums(`siTIP60-rpt1.antisense.mx`[index,])/length(temp[index]))
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','firebrick3','royalblue2','royalblue3'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
ChIPPlotonTemp <- function(temp,antibody,inputfix,name,figurefile){
siCTL.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siCTL_',inputfix,'_scaled.mx'))
siTIP60.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siTIP60_',inputfix,'_scaled.mx'))
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(siCTL.mx[index,])/length(temp[index]),
siTIP60 = colSums(siTIP60.mx[index,])/length(temp[index]))
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','royalblue2'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
temp <- res.deseq2[gene_type == 'protein_coding' & regulation == 'NC',] %>% makeGRangesFromDataFrame()
GROPlotonTemp(temp,'NC_genes','NC_protein_coding_genes','figures/GRO-seq_on_NC_protein_coding.jpg')
GROPlotonTemp <- function(gr,inputfix,name,figurefile){
Direction2Gene(paste0('matrix/Hela-siCTL-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siCTL-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siCTL-rpt1')
Direction2Gene(paste0('matrix/Hela-siTIP60-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siTIP60-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siTIP60-rpt1')
index <- seqnames(temp) != 'chrM' %>% as.logical()
plot.dt <- data.table(siCTL = colSums(`siCTL-rpt1.sense.mx`[index,])/length(temp[index]),
siCTL_AS = -colSums(`siCTL-rpt1.antisense.mx`[index,])/length(temp[index]),
siTIP60 = colSums(`siTIP60-rpt1.sense.mx`[index,])/length(temp[index]),
siTIP_AS = -colSums(`siTIP60-rpt1.antisense.mx`[index,])/length(temp[index]))
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','firebrick3','royalblue2','royalblue3'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
ChIPPlotonTemp <- function(temp,antibody,inputfix,name,figurefile){
siCTL.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siCTL_',inputfix,'_scaled.mx'))
siTIP60.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siTIP60_',inputfix,'_scaled.mx'))
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(siCTL.mx[index,])/length(temp[index]),
siTIP60 = colSums(siTIP60.mx[index,])/length(temp[index]))
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','royalblue2'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
temp <- res.deseq2[gene_type == 'protein_coding' & regulation == 'NC',] %>% makeGRangesFromDataFrame()
GROPlotonTemp(temp,'NC_genes','NC_protein_coding_genes','figures/GRO-seq_on_NC_protein_coding.jpg')
index <- seqnames(temp) != 'chrM' %>% as.logical()
head(index)
index <- seqnames(temp) != 'chrM' %>% as.logical() %>% as.vector()
head(index)
index <- seqnames(temp) != 'chrM' %>% as.vector()
index
class(index)
inverse.rle(index)
index <- as.data.table(temp)$seqnames != 'chrM'
head(index)
GROPlotonTemp <- function(gr,inputfix,name,figurefile){
Direction2Gene(paste0('matrix/Hela-siCTL-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siCTL-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siCTL-rpt1')
Direction2Gene(paste0('matrix/Hela-siTIP60-rpt1-GROpos_',inputfix,'_scaled.mx'),
paste0('matrix/Hela-siTIP60-rpt1-GROneg_',inputfix,'_scaled.mx'),
temp,'siTIP60-rpt1')
index <- as.data.table(temp)$seqnames != 'chrM'
plot.dt <- data.table(siCTL = colSums(`siCTL-rpt1.sense.mx`[index,])/length(temp[index]),
siCTL_AS = -colSums(`siCTL-rpt1.antisense.mx`[index,])/length(temp[index]),
siTIP60 = colSums(`siTIP60-rpt1.sense.mx`[index,])/length(temp[index]),
siTIP_AS = -colSums(`siTIP60-rpt1.antisense.mx`[index,])/length(temp[index]))
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','firebrick3','royalblue2','royalblue3'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
ChIPPlotonTemp <- function(temp,antibody,inputfix,name,figurefile){
siCTL.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siCTL_',inputfix,'_scaled.mx'))
siTIP60.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siTIP60_',inputfix,'_scaled.mx'))
index <- seqnames(temp) != 'chrM'
plot.dt <- data.table(siCTL = colSums(siCTL.mx[index,])/length(temp[index]),
siTIP60 = colSums(siTIP60.mx[index,])/length(temp[index]))
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','royalblue2'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
GROPlotonTemp(temp,'NC_genes','NC_protein_coding_genes','figures/GRO-seq_on_NC_protein_coding.jpg')
ChIPPlotonTemp(temp,'H3K27ac','NC_genes','H3K27ac_NC_protein_coding_genes','figures/H3K27ac_on_NC_protein_coding.jpg')
ChIPPlotonTemp(temp,'H3K4me1','NC_genes','H3K4me1_NC_protein_coding_genes','figures/H3K4me1_on_NC_protein_coding.jpg')
ChIPPlotonTemp(temp,'Pol2','NC_genes','Pol2_NC_protein_coding_genes','figures/Pol2_on_NC_protein_coding.jpg')
ChIPPlotonTemp <- function(temp,antibody,inputfix,name,figurefile){
siCTL.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siCTL_',inputfix,'_scaled.mx'))
siTIP60.mx <- ReadMatrix(paste0('matrix/Hela-',antibody,'-SC-siTIP60_',inputfix,'_scaled.mx'))
index <- as.data.table(temp)$seqnames != 'chrM'
plot.dt <- data.table(siCTL = colSums(siCTL.mx[index,])/length(temp[index]),
siTIP60 = colSums(siTIP60.mx[index,])/length(temp[index]))
MxProfilePlot(plot.dt, breaks =c(1,61,261,320)) +
scale_color_manual(values = c('firebrick2','royalblue2'))+
labs(title = name) +
theme(plot.title = element_text(hjust = 0.5))
ggsave(figurefile, height = 6, width = 8, dpi = 150, units = 'in')
}
ChIPPlotonTemp(temp,'H3K27ac','NC_genes','H3K27ac_NC_protein_coding_genes','figures/H3K27ac_on_NC_protein_coding.jpg')
ChIPPlotonTemp(temp,'H3K4me1','NC_genes','H3K4me1_NC_protein_coding_genes','figures/H3K4me1_on_NC_protein_coding.jpg')
ChIPPlotonTemp(temp,'Pol2','NC_genes','Pol2_NC_protein_coding_genes','figures/Pol2_on_NC_protein_coding.jpg')
temp <- res.deseq2[gene_type == 'protein_coding' & regulation == 'Increase',] %>% makeGRangesFromDataFrame()
GR2BED(temp,'coordinates/Increase_genes_siTIP60.bed')
GROPlotonTemp(temp,'Increase_genes','Increased_protein_coding_genes','figures/GRO-seq_on_increase_protein_coding.jpg')
ChIPPlotonTemp(temp,'H3K27ac','Increase_genes','H3K27ac_Increase_protein_coding_genes','figures/H3K27ac_on_Increase_protein_coding.jpg')
ChIPPlotonTemp(temp,'H3K4me1','Increase_genes','H3K4me1_Increase_protein_coding_genes','figures/H3K4me1_on_Increase_protein_coding.jpg')
ChIPPlotonTemp(temp,'Pol2','Increase_genes','Pol2_Increase_protein_coding_genes','figures/Pol2_on_Increase_protein_coding.jpg')
temp <- res.deseq2[gene_type == 'protein_coding' & regulation == 'Decrease',] %>% makeGRangesFromDataFrame()
GR2BED(temp,'coordinates/Decrease_genes_siTIP60.bed')
GROPlotonTemp(temp,'Decrease_genes','Decreased_protein_coding_genes','figures/GRO-seq_on_decrease_protein_coding.jpg')
ChIPPlotonTemp(temp,'H3K27ac','Decrease_genes','H3K27ac_Decrease_protein_coding_genes','figures/H3K27ac_on_Decrease_protein_coding.jpg')
ChIPPlotonTemp(temp,'H3K4me1','Decrease_genes','H3K4me1_Decrease_protein_coding_genes','figures/H3K4me1_on_Decrease_protein_coding.jpg')
ChIPPlotonTemp(temp,'Pol2','Decrease_genes','Pol2_Decrease_protein_coding_genes','figures/Pol2_on_Decrease_protein_coding.jpg')
genes.region <- genes(TxDb.Hsapiens.UCSC.hg19.knownGene)
exons.region <- exons(TxDb.Hsapiens.UCSC.hg19.knownGene)
test <- findOverlaps(genes.region,exons.region) %>% as.data.table()
test <- test[,.N, by = queryHits]
exon.count <- data.table(ENTREZID=genes.region$gene_id, exon.n = test$N)
plot.table <- res.deseq2[gene_type == 'protein_coding',]
temp <- AnnotationDbi::select(org.Hs.eg.db,plot.table$gene_name,'ENTREZID',keytype = 'SYMBOL')
plot.table <- merge(plot.table, temp,by.x = 'gene_name',by.y ='SYMBOL',all.x = F,all.y =F)
plot.table <- merge(plot.table,exon.count,by = 'ENTREZID',all.x = T, all.y = F)
plot.table$rpkm <- select(plot.table,contains('Homer')) %>% rowSums()*10E9/(plot.table$width*total.reads)
plot.table <- res.deseq2[gene_type == 'protein_coding' & seqnames != 'chrM',]
temp <- AnnotationDbi::select(org.Hs.eg.db,plot.table$gene_name,'ENTREZID',keytype = 'SYMBOL')
plot.table <- merge(plot.table, temp,by.x = 'gene_name',by.y ='SYMBOL',all.x = F,all.y =F)
plot.table <- merge(plot.table,exon.count,by = 'ENTREZID',all.x = T, all.y = F)
plot.table$rpkm <- select(plot.table,contains('Homer')) %>% rowSums()*10E9/(plot.table$width*total.reads)
p <- ggplot(plot.table,aes(x= regulation, y = rpkm))
p + geom_boxplot()
temp <- boxplot.stats(plot.table$rpkm)[c(1,5)]
p + geom_boxplot() + ylim(temp*1.05)
temp <- boxplot.stats(plot.table$rpkm)$stats[c(1,5)]
p + geom_boxplot() + ylim(temp*1.05)
p + geom_boxplot(outlier.shape = NA) + ylim(temp*1.05)
plot.table[,regulation := factor(regulation, levels = c('Decrease','NC','Increase'))]
p <- ggplot(plot.table,aes(x= regulation, y = rpkm))
temp <- boxplot.stats(plot.table$rpkm)$stats[c(1,5)]
p + geom_boxplot(outlier.shape = NA) + ylim(temp*1.05)
p + geom_boxplot(outlier.shape = NA) + ylim(temp*1.05) + theme_xf
p <- ggplot(plot.table,aes(x= regulation, y = rpkm, color = regulation))
temp <- boxplot.stats(plot.table$rpkm)$stats[c(1,5)]
p + geom_boxplot(outlier.shape = NA) + ylim(temp*1.05) + theme_xf
p + geom_boxplot(outlier.shape = NA, lwd =2) + ylim(temp*1.05) + theme_xf
p <- ggplot(plot.table,aes(x= regulation, y = rpkm))
temp <- boxplot.stats(plot.table$rpkm)$stats[c(1,5)]
p + geom_boxplot(outlier.shape = NA, lwd =1) + ylim(temp*1.05) + theme_xf
p + geom_boxplot(outlier.shape = NA, lwd =1) + ylim(temp*1.05) + theme_xf + labs(x =NULL)
p + geom_boxplot(outlier.shape = NA, lwd =1) + ylim(temp*1.05) + theme_xf + labs(title = 'Expression of protein coding genes',x =NULL)
p + geom_boxplot(outlier.shape = NA, lwd =1) +
ylim(temp*1.05) +
theme_xf +
labs(title = 'Expression of protein coding genes',x =NULL) +
theme(plot.title = element_text(hjust =0.5))
ggsave(filename = 'figures/Expression_boxplot_coding.jpg', width = 6, height = 6, dpi =150, units = 'in')
ggsave(filename = 'figures/Expression_boxplot_coding.jpg', width = 4, height = 4, dpi =150, units = 'in')
p <- ggplot(plot.table,aes(x= as.factor(exon.n), y = log2FoldChange))
p + geom_boxplot()
plot.table[exon.n > 30, exon.n := 30]
plot.table[!is.na(exon.n),]
plot.table <- plot.table[!is.na(exon.n),]
plot.table[,exon.n := as.character(exon.n)][exon.n == '30', exon.n := '>= 30']
table(plot.table$exon.n)
plot.table[exon.n == '>= 30', exon.n := '30+']
table(plot.table$exon.n)
plot.table[,exon.n := factor(exon.n,levels = c(as.character(1:29),'30+'))]
table(plot.table$exon.n)
plot.table <- plot.table[,.(Mean = mean(log2FoldChange),SD = sd(log2FoldChange)), by = exon.n]
plot.table
plot.table <- res.deseq2[gene_type == 'protein_coding' & seqnames != 'chrM',]
temp <- AnnotationDbi::select(org.Hs.eg.db,plot.table$gene_name,'ENTREZID',keytype = 'SYMBOL')
plot.table <- merge(plot.table, temp,by.x = 'gene_name',by.y ='SYMBOL',all.x = F,all.y =F)
plot.table <- merge(plot.table,exon.count,by = 'ENTREZID',all.x = T, all.y = F)
plot.table$rpkm <- select(plot.table,contains('Homer')) %>% rowSums()*10E9/(plot.table$width*total.reads)
plot.table[,regulation := factor(regulation, levels = c('Decrease','NC','Increase'))]
plot.table[exon.n > 30, exon.n := 30]
plot.table <- plot.table[!is.na(exon.n),]
plot.table[,exon.n := as.character(exon.n)][exon.n == '30', exon.n := '30+']
plot.table[,exon.n := factor(exon.n,levels = c(as.character(1:29),'30+'))]
test <- plot.table[,.(Mean = mean(log2FoldChange),SD = se(log2FoldChange)), by = exon.n]
test <- plot.table[,.(.N,Mean = mean(log2FoldChange),SD = se(log2FoldChange)), by = exon.n]
test <- plot.table[,.(.N,Mean = mean(log2FoldChange),SD = sd(log2FoldChange)), by = exon.n]
test
test[order(-Mean)]
test <- plot.table[,.(.N,Mean = median(log2FoldChange),SD = sd(log2FoldChange)), by = exon.n]
test[order(-Mean)]
plot.table <- res.deseq2[gene_type == 'protein_coding' & seqnames != 'chrM',]
plot.table[exon.n > 30, exon.n := 30]
plot.table <- plot.table[!is.na(exon.n),]
plot.table <- res.deseq2[gene_type == 'protein_coding' & seqnames != 'chrM',]
plot.table$rpkm <- select(plot.table,contains('Homer')) %>% rowSums()*10E9/(plot.table$width*total.reads)
plot.table[,regulation := factor(regulation, levels = c('Decrease','NC','Increase'))]
p <- ggplot(plot.table,aes(x= regulation, y = rpkm))
temp <- boxplot.stats(plot.table$rpkm)$stats[c(1,5)]
p + geom_boxplot(outlier.shape = NA, lwd =1) +
ylim(temp*1.05) +
theme_xf +
labs(title = 'Expression of protein coding genes',x =NULL) +
theme(plot.title = element_text(hjust =0.5))
genes.region <- genes(TxDb.Hsapiens.UCSC.hg19.knownGene)
exons.region <- exons(TxDb.Hsapiens.UCSC.hg19.knownGene)
test <- findOverlaps(genes.region,exons.region) %>% as.data.table()
test <- test[,.N, by = queryHits]
exon.count <- data.table(ENTREZID=genes.region$gene_id, exon.n = test$N)
plot.table <- res.deseq2[gene_type == 'protein_coding' & seqnames != 'chrM',]
temp <- AnnotationDbi::select(org.Hs.eg.db,plot.table$gene_name,'ENTREZID',keytype = 'SYMBOL')
plot.table <- merge(plot.table, temp,by.x = 'gene_name',by.y ='SYMBOL',all.x = F,all.y =F)
plot.table <- merge(plot.table,exon.count,by = 'ENTREZID',all.x = T, all.y = F)
plot.table[exon.n > 30, exon.n := 30]
plot.table <- plot.table[!is.na(exon.n),]
plot.table[,exon.n := as.character(exon.n)][exon.n == '30', exon.n := '30+']
plot.table[,exon.n := factor(exon.n,levels = c(as.character(1:29),'30+'))]
test <- plot.table[,.(.N,Mean = median(log2FoldChange),SD = sd(log2FoldChange)), by = exon.n]
p <- ggplot(plot.table,aes(x= as.factor(exon.n), y = log2FoldChange))
p + geom_boxplot()
test
